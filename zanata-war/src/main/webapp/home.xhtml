<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  template="./WEB-INF/template/template_2x.xhtml">

  <ui:define name="page_title">#{msgs['jsf.Home']}</ui:define>
  <ui:define name="center_content">
    <noscript>
      <div>
        Note: the following CommonMark text can only be rendered if
        JavaScript is enabled.
      </div>
    </noscript>
    <ui:remove>
      This will be rendered to HTML in JavaScript and replaced by a div.
      TODO render CM to HTML on the server side.
    </ui:remove>
    <pre class="js-commonmark" id="project-home-content">#{applicationConfiguration.homeContent}</pre>
    <div id="project-home-content-rendered"></div>

    <h:outputScript target="body" library="script" name="commonmark-0.18.1.min.js"/>

    <script type="text/javascript">
      $(function() {
        var reader = new commonmark.Parser();
        var writer = new commonmark.HtmlRenderer();
        function mdRender(src) {
          return writer.render(reader.parse(src));
        }
        var rendered = mdRender($('#project-home-content').text());
        $('#project-home-content-rendered').html(rendered);
        $('#project-home-content').remove();
      });
    </script>

  </ui:define>

  <ui:define name="right_content">
    <rich:panel id="loggedIn" rendered="#{s:hasRole('admin')}">
      <f:facet name="header">#{msgs['jsf.Actions']}</f:facet>
      <s:link styleClass="action_link"
        value="#{msgs['jsf.server.EditHomePage.label']}"
        view="/edit_home_content.xhtml" propagation="none">
      </s:link>
    </rich:panel>
  </ui:define>

</ui:composition>
